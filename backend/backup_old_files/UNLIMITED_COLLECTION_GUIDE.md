# 무제한 Freshdesk 티켓 수집 가이드

이 가이드는 Freshdesk에서 500만건 이상의 티켓 데이터를 제한 없이 수집하는 방법을 제공합니다.

## 실행 방법

### 1. 백그라운드 실행 (권장)
```bash
# 실행 권한 부여
chmod +x run_full_collection.sh monitor_collection.sh

# 백그라운드에서 실행
./run_full_collection.sh

# 진행 상황 모니터링
./monitor_collection.sh -w
```

### 2. 직접 실행
```bash
python run_collection.py
# 메뉴에서 '1. 전체 수집 (무제한)' 선택
```

## 주요 최적화 전략

### 1. 메모리 사용량 최적화
- **청크 크기 축소**: 5,000개 단위로 저장하여 메모리 사용량 감소
- **주기적인 메모리 모니터링**: 80% 이상 사용 시 경고 및 조치

### 2. 디스크 공간 관리
- **최소 필요 공간**: 500만건 기준 약 100GB 이상 권장
- **자동 디스크 체크**: 90% 이상 사용 시 수집 일시 중단

### 3. 자동 복구 메커니즘
- **진행 상황 저장**: 100개 티켓마다 진행 상황 저장
- **날짜 기반 분할**: 30일 단위로 분할하여 개별 처리
- **중단 지점 재개**: 오류 발생 시 중단된 날짜 범위부터 재개

### 4. 네트워크 안정성
- **더 보수적인 요청 간격**: 0.5초 (Rate Limit 안전 대응)
- **자동 재시도 증가**: 최대 10회 재시도로 일시적 장애 극복
- **Rate Limit 자동 감지**: 응답 헤더 기반 대기 시간 조정

## 모니터링

### 실시간 진행 상황
```bash
# 계속 업데이트되는 모니터링 (5분 간격)
./monitor_collection.sh -w

# 현재 상태만 확인
./monitor_collection.sh
```

### 로그 확인
```bash
# 실시간 로그 확인
tail -f freshdesk_full_collection.log

# 마지막 100줄 확인
tail -n 100 freshdesk_full_collection.log
```

### 수집 중단
```bash
# PID 파일 이용해 중단
kill $(cat freshdesk_collection.pid)
```

## 예상 소요 시간

| 티켓 수 | 예상 시간 | 필요 디스크 공간 |
|---------|----------|----------------|
| 500만건 | 2-3주    | 100-150GB      |
| 1000만건| 1-2개월  | 200-300GB      |

* 네트워크 상태, 서버 응답 시간에 따라 달라질 수 있음

## 주의사항

1. **장기간 실행 필요**: 백그라운드에서 실행하고 정기적으로 모니터링
2. **충분한 디스크 공간**: 최소 티켓 수 * 20KB + 여유 공간
3. **네트워크 안정성**: 유선 네트워크 환경 권장
4. **정기적 백업**: 수집된 청크 파일 주기적 백업 권장

## 문제 해결

### 메모리 부족
- `large_scale_config.py`에서 `CHUNK_SIZE`를 더 낮게 조정 (예: 2000)
- 서버 메모리 증설 고려

### 디스크 공간 부족
- 기존 청크 백업 후 이동/삭제
- 필요 시 수집 일시 중단 후 디스크 공간 확보

### 네트워크 문제
- `REQUEST_DELAY` 값 증가 (예: 1.0초)
- 안정적인 네트워크 환경으로 변경
