<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copilot Canvas - AI 상담사 지원</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 0 0 10px 0;
            color: #1f2937;
            display: flex;
            justify-content: flex-end;
            line-height: 1.5;
            height: 100%;
            width: 100%;
            overflow: auto;
        }

        /* === FDK 응답 컨테이너 (필수) === */
        #fdk-response-container {
            width: 100%;
            height: 100%;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            animation: slideIn 0.3s ease-out;
            position: relative;
            overflow: hidden;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 모달 컨테이너 (네이티브 스타일) */
        .modal-container {
            width: 480px;
            height: calc(100vh - 10px);
            background: white;
            border-radius: 12px;
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            border-left: 1px solid #e5e7eb;
            margin-bottom: 10px;
        }

        /* 스마트 헤더 (얇은 헤더) */
        .smart-header {
            background: linear-gradient(135deg, #8B5CF6 0%, #3B82F6 100%);
            color: white;
            padding: 8px 20px;
            flex-shrink: 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ticket-meta {
            display: flex;
            gap: 10px;
            font-size: 12px;
        }

        .meta-item {
            background: rgba(255, 255, 255, 0.15);
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 메인 콘텐츠 */
        .main-content {
            display: flex;
            flex-direction: column;
            /* flex: 1과 min-height 제거 - 자연스러운 콘텐츠 흐름 */
        }

        /* AI 요약 영역 (FDK 스타일) - 접기/펴기 처리 */
        .ai-summary-section {
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            padding: 0;
            flex-shrink: 0;
            overflow: visible;
            transition: all 0.3s ease;
        }

        .ai-summary-section.collapsed {
            max-height: 0;
            border-bottom: none;
            opacity: 0;
        }

        .ai-summary-section.expanded {
            max-height: 500px;
            opacity: 1;
        }

        .summary-header {
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .summary-title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-title i {
            color: #8B5CF6;
        }

        .summary-toggle-icon {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            min-width: 40px;
        }

        .summary-toggle-icon:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .summary-actions {
            display: flex;
            gap: 8px;
        }

        .summary-action-btn {
            background: white;
            border: 1px solid #d1d5db;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
            color: #374151;
        }

        .summary-action-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .summary-content {
            padding: 16px 20px;
            transition: all 0.3s ease;
            /* 고정 높이 제거 - 콘텐츠 길이에 따라 자연스럽게 확장 */
        }

        .ai-summary-section.collapsed .summary-content {
            padding: 0 20px;
        }

        .main-summary .summary-text {
            font-size: 14px;
            line-height: 1.6;
            color: #374151;
            background: white;
            padding: 16px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        /* 탭 네비게이션 (FDK 스타일) */
        .tab-navigation {
            background-color: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            padding: 0;
            flex-shrink: 0;
        }

        .tab-list {
            display: flex;
            margin: 0;
            padding: 0;
            width: 100%;
        }

        .tab-button {
            background: none;
            border: none;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 13px;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            position: relative;
            white-space: nowrap;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }

        .tab-button:hover {
            color: #374151;
            background-color: #f9fafb;
        }

        .tab-button.active {
            color: #8B5CF6;
            border-bottom-color: #8B5CF6;
            background-color: #faf5ff;
        }

        .tab-count {
            background-color: #e5e7eb;
            color: #6b7280;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 600;
            min-width: 18px;
            text-align: center;
        }

        .tab-button.active .tab-count {
            background-color: #8B5CF6;
            color: white;
        }

        /* 카드 리스트 영역 */
        .card-list {
            padding: 16px 20px;
            /* flex와 overflow 제거 - 자연스러운 콘텐츠 흐름 */
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.2s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 인사이트 패널 (FDK 스타일) */
        .insight-panel {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 16px;
        }

        .insight-title {
            font-size: 12px;
            font-weight: 600;
            color: #92400e;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .insight-content {
            font-size: 11px;
            color: #92400e;
            line-height: 1.4;
        }

        /* 콘텐츠 카드 (FDK 스타일) */
        .content-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .content-card:hover {
            border-color: #8B5CF6;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1);
            transform: translateY(-1px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
        }

        .card-id {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #6b7280;
            font-weight: 600;
        }

        .similarity-score {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            color: white;
        }

        .score-high { background: #10b981; }
        .score-medium { background: #f59e0b; }
        .score-low { background: #ef4444; }

        .card-body {
            padding: 12px 16px;
        }

        .card-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
            line-height: 1.4;
            font-size: 14px;
        }

        .card-excerpt {
            color: #6b7280;
            font-size: 13px;
            line-height: 1.4;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            color: #9ca3af;
            margin-bottom: 12px;
        }

        .meta-left {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .status-indicator {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
        }

        .status-resolved { background: #d1fae5; color: #065f46; }
        .status-progress { background: #dbeafe; color: #1e40af; }
        .status-pending { background: #fef3c7; color: #92400e; }

        .priority-indicator {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .card-actions {
            display: flex;
            gap: 8px;
        }

        .card-btn {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            color: #6b7280;
        }

        .card-btn.primary {
            background: linear-gradient(135deg, #8B5CF6 0%, #3B82F6 100%);
            color: white;
            border-color: #8B5CF6;
        }

        .card-btn:hover {
            background: #f3f4f6;
            border-color: #8B5CF6;
            color: #8B5CF6;
        }

        .card-btn.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(139, 92, 246, 0.3);
        }

        /* Copilot 탭 특별 스타일 */
        .copilot-welcome {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 32px 20px;
            text-align: center;
            margin-top: 20px;
        }

        .copilot-welcome .copilot-icon {
            font-size: 48px;
            margin-bottom: 16px;
            color: #8B5CF6;
        }

        .copilot-welcome h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }

        .copilot-welcome p {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .copilot-btn {
            background: linear-gradient(135deg, #8B5CF6 0%, #3B82F6 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .copilot-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        /* 피드백 영역 */
        .feedback-section {
            padding: 12px 20px;
            background: #f8fafc;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .feedback-question {
            font-size: 12px;
            color: #6b7280;
        }

        .feedback-actions {
            display: flex;
            gap: 8px;
        }

        .feedback-btn {
            background: white;
            border: 1px solid #d1d5db;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
            color: #6b7280;
        }

        .feedback-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .feedback-btn.thumbs-up:hover {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .feedback-btn.thumbs-down:hover {
            background: #fee2e2;
            border-color: #ef4444;
            color: #991b1b;
        }

        /* 성능 지표 */
        .performance-footer {
            padding: 8px 20px;
            background: #f1f5f9;
            border-top: 1px solid #e5e7eb;
            font-size: 10px;
            color: #6b7280;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
        }

        .perf-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* 스크롤바 스타일링 - 모달 컨테이너에만 적용 */
        .modal-container::-webkit-scrollbar {
            width: 4px;
        }

        .modal-container::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .modal-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        .modal-container::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* 마크다운 스타일 */
        .summary-text h2 {
            font-size: 14px;
            font-weight: 700;
            color: #1f2937;
            margin: 12px 0 6px 0;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 4px;
        }

        .summary-text h3 {
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            margin: 10px 0 4px 0;
        }

        .summary-text p {
            margin: 6px 0;
            line-height: 1.5;
        }

        .summary-text ul,
        .summary-text ol {
            margin: 8px 0;
            padding-left: 20px;
        }

        .summary-text li {
            margin: 3px 0;
            line-height: 1.4;
        }

        .summary-text strong,
        .summary-text b {
            color: #1f2937;
            font-weight: 700;
        }

        /* 반응형 */
        @media (max-width: 500px) {
            .modal-container {
                width: 100%;
                border-left: none;
            }
            
            .header-content {
                flex-direction: column;
                gap: 8px;
            }
            
            .tab-list {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <!-- FDK 응답 컨테이너 (필수) -->
    <div id="fdk-response-container">
        <div class="modal-container">
        <!-- 얇은 헤더 (메타 정보와 액션 버튼) -->
        <header class="smart-header">
            <div class="header-content">
                <div class="ticket-meta">
                    <span class="meta-item">😐 보통</span>
                    <span class="meta-item">해결완료</span>
                    <span class="meta-item">김상담 (CS팀)</span>
                </div>
                <div class="header-actions">
                    <button class="action-btn" onclick="toggleSummary()" id="summaryToggleBtn" title="요약 접기/펼기">
                        <span style="font-size: 16px;">⌃</span>
                    </button>
                    <button class="action-btn" onclick="refreshData()" title="새로고침">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- 에러 표시 영역 (초기에는 숨김) -->
        <div id="error-display" style="display: none;">
            <!-- 에러 메시지가 여기에 동적으로 표시됩니다 -->
        </div>

        <!-- 메인 콘텐츠 -->
        <main class="main-content" id="main-content">
            <!-- AI 요약 영역 -->
            <section class="ai-summary-section" id="summarySection">
                <div class="summary-header">
                    <div class="summary-title">
                        <i class="fas fa-brain"></i>
                        AI 요약 분석
                    </div>
                    <div class="summary-actions">
                        <button class="summary-action-btn" onclick="copySummary()">
                            📋 복사
                        </button>
                        <button class="summary-action-btn" onclick="regenerateSummary()">
                            ⚡ 재생성
                        </button>
                    </div>
                </div>
                <div class="summary-content" id="summaryContent">
                    <div class="main-summary">
                        <div class="summary-text">
                            🔍 <strong>문제 현황</strong><br>
                            - 핵심 문제와 증상: 아세아홀딩스 라이선스 1명 추가 요청<br>
                            - 고객 배경 정보: 아세아지주사 세금계산서 담당자로부터 요청<br>
                            - 비즈니스 임팩트: 라이선스 추가로 인한 업무 효율성 향상<br>
                            - 감정 상태: 요청은 협조적이며 긍정적으로 보임<br><br>
                            
                            💡 <strong>원인 분석</strong><br>
                            - 파악된 근본 원인: 아세아홀딩스 라이선스 추가 요청<br>
                            - 기여 요인들: 고객의 업무 확장 또는 새로운 사용자 추가<br>
                            - 기술적 세부사항: 라이선스 관련 정보 전달 필요<br>
                            - 원인 확실성 수준: 확정<br><br>
                            
                            ⚡ <strong>해결 진행상황</strong><br>
                            - 현재 상태: 라이선스 추가 작업 진행 중<br>
                            - 수행된 조치들: We Do Soft에서 추가 작업 진행 중<br>
                            - 시도한 해결책과 결과: 라이선스 추가 작업 진행 중<br>
                            - 다음 단계 계획: 아세아홀딩스 재무 담당자 정보 전달 예정<br>
                            - 예상 해결 시간: 미정<br><br>
                            
                            🎯 <strong>중요 인사이트</strong><br>
                            - 향후 처리 방향: 라이선스 추가 작업 완료 후 고객 확인 요청<br>
                            - 에스컬레이션 필요성: 현재 단계에서는 필요 없음<br>
                            - 예방 조치 권장사항: 고객 요청에 따라 신속하게 처리<br>
                            - 고객 관리 방안: 고객 요청 사항에 대한 신속한 응대<br>
                            - 학습 포인트: 유사한 요청 시 빠른 대응 필요
                        </div>
                    </div>
                </div>
            </section>

            <!-- 탭 네비게이션 -->
            <nav class="tab-navigation">
                <div class="tab-list">
                    <button class="tab-button active" data-tab="tickets">
                        📱 유사 티켓
                        <span class="tab-count">3</span>
                    </button>
                    <button class="tab-button" data-tab="kb">
                        📚 KB 문서
                        <span class="tab-count">2</span>
                    </button>
                    <button class="tab-button" data-tab="copilot">
                        🤖 Copilot
                    </button>
                </div>
            </nav>

            <!-- 카드 리스트 영역 -->
            <div class="card-list">
                <!-- 유사 티켓 탭 콘텐츠 -->
                <div class="tab-content active" data-tab="tickets">
                    <div class="insight-panel">
                        <div class="insight-title">💡 자동 분석 결과</div>
                        <div class="insight-content">
                            🎯 평균 유사도: 78% (3건 중 2건이 80% 이상)<br>
                            📊 상태 분포: 해결완료 2건, 진행중 1건<br>
                            🏷️ 공통 키워드: "라이선스", "추가", "메일시스템"
                        </div>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <span class="card-id">#104</span>
                            <span class="similarity-score score-high">🟢 85%</span>
                        </div>
                        <div class="card-body">
                            <div class="card-title">
                                전자결재 결재 완료시 PDF 파일 수신 오류의 건
                            </div>
                            <div class="card-excerpt">
                                아시아홀딩스의 메일 시스템 라이선스가 현재 7명까지 있어서, 1명을 추가하고 싶습니다.
                            </div>
                            <div class="card-meta">
                                <div class="meta-left">
                                    <span>📅 2015-04-10</span>
                                    <span class="status-indicator status-resolved">해결완료</span>
                                    <span class="priority-indicator">🔥 긴급</span>
                                </div>
                                <span>2일 전</span>
                            </div>
                            <div class="card-actions">
                                <button class="card-btn primary" onclick="viewSummary('#104')">
                                    👁️ 요약보기
                                </button>
                                <button class="card-btn" onclick="viewOriginal('#104')">
                                    📄 원본보기
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <span class="card-id">#105</span>
                            <span class="similarity-score score-medium">🟡 78%</span>
                        </div>
                        <div class="card-body">
                            <div class="card-title">
                                라이선스 관련 업무 처리 요청
                            </div>
                            <div class="card-excerpt">
                                기업 내 데이터 분석을 위한 최적의 도구 선택과 비용 대비 효과 분석을 위한 문의입니다.
                            </div>
                            <div class="card-meta">
                                <div class="meta-left">
                                    <span>📅 2015-03-15</span>
                                    <span class="status-indicator status-progress">진행중</span>
                                    <span class="priority-indicator">🔵 보통</span>
                                </div>
                                <span>1주일 전</span>
                            </div>
                            <div class="card-actions">
                                <button class="card-btn primary" onclick="viewSummary('#105')">
                                    👁️ 요약보기
                                </button>
                                <button class="card-btn" onclick="viewOriginal('#105')">
                                    📄 원본보기
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <span class="card-id">#106</span>
                            <span class="similarity-score score-medium">🟡 72%</span>
                        </div>
                        <div class="card-body">
                            <div class="card-title">
                                메일 시스템 확장 관련 문의
                            </div>
                            <div class="card-excerpt">
                                AI 도구 도입 시 비용을 최적화하고 효율적인 예산 계획을 수립하는 방법에 대한 문의입니다.
                            </div>
                            <div class="card-meta">
                                <div class="meta-left">
                                    <span>📅 2015-02-20</span>
                                    <span class="status-indicator status-resolved">해결완료</span>
                                    <span class="priority-indicator">🟠 높음</span>
                                </div>
                                <span>2주일 전</span>
                            </div>
                            <div class="card-actions">
                                <button class="card-btn primary" onclick="viewSummary('#106')">
                                    👁️ 요약보기
                                </button>
                                <button class="card-btn" onclick="viewOriginal('#106')">
                                    📄 원본보기
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KB 문서 탭 콘텐츠 -->
                <div class="tab-content" data-tab="kb">
                    <div class="insight-panel">
                        <div class="insight-title">📚 지식베이스 검색 결과</div>
                        <div class="insight-content">
                            🎯 관련도 높은 문서: 2건<br>
                            📊 평균 관련성: 85%<br>
                            🏷️ 주제: 라이선스 관리, 시스템 확장
                        </div>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <span class="card-id">KB-001</span>
                            <span class="similarity-score score-high">🟢 89%</span>
                        </div>
                        <div class="card-body">
                            <div class="card-title">
                                라이선스 추가 신청 및 승인 프로세스
                            </div>
                            <div class="card-excerpt">
                                기업 라이선스 추가 신청 시 필요한 서류와 승인 프로세스에 대한 상세 가이드입니다.
                            </div>
                            <div class="card-meta">
                                <div class="meta-left">
                                    <span>📅 2024-01-15</span>
                                    <span class="status-indicator status-resolved">최신</span>
                                    <span>📂 시스템관리</span>
                                </div>
                                <span>업데이트: 1개월 전</span>
                            </div>
                            <div class="card-actions">
                                <button class="card-btn primary" onclick="viewKBSummary('KB-001')">
                                    👁️ 요약보기
                                </button>
                                <button class="card-btn" onclick="viewKBOriginal('KB-001')">
                                    📄 원본보기
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="content-card">
                        <div class="card-header">
                            <span class="card-id">KB-002</span>
                            <span class="similarity-score score-high">🟢 82%</span>
                        </div>
                        <div class="card-body">
                            <div class="card-title">
                                메일 시스템 용량 및 사용자 확장 가이드
                            </div>
                            <div class="card-excerpt">
                                메일 시스템의 사용자 수 확장과 관련된 기술적 요구사항 및 절차를 설명합니다.
                            </div>
                            <div class="card-meta">
                                <div class="meta-left">
                                    <span>📅 2024-02-10</span>
                                    <span class="status-indicator status-resolved">최신</span>
                                    <span>📂 기술지원</span>
                                </div>
                                <span>업데이트: 3주 전</span>
                            </div>
                            <div class="card-actions">
                                <button class="card-btn primary" onclick="viewKBSummary('KB-002')">
                                    👁️ 요약보기
                                </button>
                                <button class="card-btn" onclick="viewKBOriginal('KB-002')">
                                    📄 원본보기
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Copilot 탭 콘텐츠 -->
                <div class="tab-content" data-tab="copilot">
                    <div class="insight-panel">
                        <div class="insight-title">🤖 AI 어시스턴트 기능</div>
                        <div class="insight-content">
                            💬 자연어 질문으로 더 정확한 답변을 받아보세요<br>
                            🎯 맞춤형 답변 생성 및 개선<br>
                            ⚡ 실시간 상담 지원
                        </div>
                    </div>

                    <div class="copilot-welcome">
                        <div class="copilot-icon">🤖</div>
                        <h3>AI Copilot</h3>
                        <p>
                            이 티켓에 대해 궁금한 점이 있으시면<br>
                            자유롭게 질문해 주세요.
                        </p>
                        <button class="copilot-btn" onclick="startChat()">
                            💬 AI와 대화하기
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- 피드백 섹션 -->
        <div class="feedback-section">
            <div class="feedback-question">이 AI 분석이 도움이 되었나요?</div>
            <div class="feedback-actions">
                <button class="feedback-btn thumbs-up" onclick="submitFeedback('positive')">
                    👍 도움됨
                </button>
                <button class="feedback-btn thumbs-down" onclick="submitFeedback('negative')">
                    👎 개선필요
                </button>
            </div>
        </div>

        <!-- 성능 지표 푸터 -->
        <div class="performance-footer">
            <div class="perf-item">
                🕒 처리시간: 3.2초
            </div>
            <div class="perf-item">
                📊 품질점수: 82%
            </div>
            <div class="perf-item">
                🔍 검색결과: 5건
            </div>
        </div>
    </div>
    <!-- FDK 응답 컨테이너 종료 -->

    <!-- FDK 스크립트 로드 -->
    <script src="https://static.freshdev.io/fdk/2.0/assets/fresh_client.js"></script>
    
    <!-- 마크다운 파서 -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    
    <!-- 앱 모듈들 (의존성 순서에 따라 로드) -->
    <script src="scripts/globals.js"></script>
    <script src="scripts/utils.js"></script>
    <script src="scripts/api.js"></script>
    <script src="scripts/data.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/events.js"></script>
    <script src="scripts/sidebar-progress.js"></script>
    <script src="scripts/app.js"></script>

    <script>
        // FDK 환경 감지 및 최적화
        (function() {
            'use strict';

            // 안전한 DOM 조작을 위한 헬퍼 함수
            function safeQuerySelector(selector) {
                try {
                    return document.querySelector(selector);
                } catch (e) {
                    console.warn('Safe query selector failed:', e);
                    return null;
                }
            }

            function safeQuerySelectorAll(selector) {
                try {
                    return document.querySelectorAll(selector);
                } catch (e) {
                    console.warn('Safe query selector all failed:', e);
                    return [];
                }
            }

            // FDK 환경 감지 및 UI 표시
            function detectEnvironment() {
                const body = document.body;
                const modalContainer = document.querySelector('.modal-container');
                
                // iframe 환경 감지
                if (window.self !== window.top) {
                    console.log('🎭 iframe 환경 감지 (width:', window.innerWidth, ', height:', window.innerHeight, ')');
                    
                    // 부모 창 크기로 모달/사이드바 구분
                    if (window.innerWidth > 500 || window.innerHeight > 500) {
                        console.log('📱 모달 모드 적용 - 전체 UI 표시');
                        body.classList.add('modal-mode');
                        body.classList.remove('sidebar-mode');
                        
                        // 모달에서 컨테이너 최대 활용
                        if (modalContainer) {
                            modalContainer.style.width = '100%';
                            modalContainer.style.maxWidth = '100%';
                        }
                    } else {
                        console.log('📱 사이드바 모드 적용');
                        body.classList.add('sidebar-mode');
                        body.classList.remove('modal-mode');
                    }
                } else {
                    console.log('🖥️ 일반 환경 감지 - 모달 UI 표시');
                    // 직접 접근 (개발/테스트) - 모달 UI 표시
                    body.classList.add('standalone-mode');
                }

                // 오류 모드 처리
                checkErrorMode();

                // 컨테이너 크기 조정
                adjustContainerSize();
            }

            // 오류 모드 확인 및 처리
            function checkErrorMode() {
                try {
                    // URL 파라미터나 전역 변수로 오류 모드 확인
                    const urlParams = new URLSearchParams(window.location.search);
                    const isErrorMode = urlParams.get('errorMode') === 'true' || window.errorMode === true;
                    
                    if (isErrorMode) {
                        console.log('🚨 오류 모드 감지 - UI에 오류 메시지 표시');
                        showErrorMessage('벡터 DB 연결 오류가 발생했지만 기본 기능은 사용할 수 있습니다.');
                    }
                } catch (error) {
                    console.warn('오류 모드 확인 중 문제 발생:', error);
                }
            }

            // 오류 메시지 표시 함수
            function showErrorMessage(message) {
                try {
                    const errorDisplay = document.getElementById('error-display');
                    if (errorDisplay) {
                        errorDisplay.innerHTML = `
                            <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin: 16px 20px; color: #92400e;">
                                <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600;">
                                    ⚠️ 시스템 알림
                                </div>
                                <div style="font-size: 13px; margin-top: 4px;">
                                    ${message}
                                </div>
                            </div>
                        `;
                        errorDisplay.style.display = 'block';
                    }
                } catch (error) {
                    console.error('오류 메시지 표시 실패:', error);
                }
            }

            // 컨테이너 크기 조정
            function adjustContainerSize() {
                const modalContainer = document.querySelector('.modal-container');
                
                if (!modalContainer) return;

                if (document.body.classList.contains('modal-mode')) {
                    console.log('📐 모달 모드 - 컨테이너 최대 활용');
                    modalContainer.style.width = '100%';
                    modalContainer.style.maxWidth = '100%';
                } else if (document.body.classList.contains('sidebar-mode')) {
                    console.log('📐 사이드바 모드 - 제한된 폭');
                    modalContainer.style.maxWidth = '400px';
                } else {
                    console.log('📐 일반 모드 - 기본 설정');
                    modalContainer.style.width = '100%';
                    modalContainer.style.maxWidth = '100%';
                }
            }

            // 즉시 환경 감지 실행
            detectEnvironment();

            // 창 크기 변경 시 재조정
            window.addEventListener('resize', function() {
                try {
                    adjustContainerSize();
                } catch (error) {
                    console.warn('Resize handler error:', error);
                }
            });

            // 에러 핸들링
            window.addEventListener('error', function(event) {
                console.warn('Runtime error caught:', event.error);
                // 에러가 발생해도 앱이 계속 동작하도록 함
            });

        })();

        // 탭 전환 기능
        function switchTab(tabName) {
            // 모든 탭 버튼 비활성화
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 모든 탭 콘텐츠 숨기기
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 선택된 탭 버튼 활성화
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            // 선택된 탭 콘텐츠 보이기
            const activeContent = document.querySelector(`.tab-content[data-tab="${tabName}"]`);
            if (activeContent) {
                activeContent.classList.add('active');
            }
        }
        
        // 탭 버튼에 이벤트 리스너 추가
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
        });

        // 요약 접기/펴기 기능 + 스크롤 디버깅
        function toggleSummary() {
            const section = document.getElementById('summarySection');
            const toggleBtn = document.getElementById('summaryToggleBtn');
            
            if (section.classList.contains('collapsed')) {
                // 펴기
                section.classList.remove('collapsed');
                toggleBtn.innerHTML = '<span style="font-size: 16px;">⌃</span>';
                console.log('펼치기 실행');
            } else {
                // 접기
                section.classList.add('collapsed');
                toggleBtn.innerHTML = '<span style="font-size: 16px;">⌄</span>';
                console.log('접기 실행');
            }
        }

        // 간단한 스크롤 이벤트 관리 - 부모 창으로의 전파만 차단
        document.addEventListener('DOMContentLoaded', function() {
            const fdkContainer = document.getElementById('fdk-response-container');
            const modalContainer = document.querySelector('.modal-container');
            
            // FDK 컨테이너에서 부모 창으로의 스크롤 전파 차단
            if (fdkContainer) {
                fdkContainer.addEventListener('wheel', function(e) {
                    e.stopPropagation(); // 부모로의 전파만 차단
                }, { passive: false });
            }
            
            // 모달 컨테이너에서 부모 창으로의 스크롤 전파 차단
            if (modalContainer) {
                modalContainer.addEventListener('wheel', function(e) {
                    e.stopPropagation(); // 부모로의 전파만 차단
                }, { passive: false });
            }
        });

        // 액션 버튼 기능들
        function copySummary() {
            const summaryText = document.querySelector('.summary-text').textContent;
            navigator.clipboard.writeText(summaryText).then(() => {
                alert('요약이 클립보드에 복사되었습니다.');
            });
        }

        function regenerateSummary() {
            alert('AI 요약을 재생성합니다.');
        }

        function closeModal() {
            alert('모달을 닫습니다.');
        }

        function refreshData() {
            const refreshBtn = document.querySelector('[title="새로고침"] i');
            if (refreshBtn) {
                refreshBtn.classList.add('fa-spin');
                setTimeout(() => {
                    refreshBtn.classList.remove('fa-spin');
                }, 2000);
            }
            alert('데이터를 새로고침합니다.');
        }

        function viewSummary(ticketId) {
            alert(`${ticketId} 티켓의 요약을 표시합니다.`);
        }

        function viewOriginal(ticketId) {
            alert(`${ticketId} 티켓의 원본을 표시합니다.`);
        }

        function viewKBSummary(kbId) {
            alert(`${kbId} 문서의 요약을 표시합니다.`);
        }

        function viewKBOriginal(kbId) {
            alert(`${kbId} 문서의 원본을 표시합니다.`);
        }

        function startChat() {
            alert('AI 채팅을 시작합니다.');
        }

        function submitFeedback(type) {
            const btn = event.target;
            if (type === 'positive') {
                btn.style.background = '#d1fae5';
                btn.style.borderColor = '#10b981';
                btn.style.color = '#065f46';
                alert('긍정적 피드백이 전송되었습니다. 감사합니다!');
            } else {
                btn.style.background = '#fee2e2';
                btn.style.borderColor = '#ef4444';
                btn.style.color = '#991b1b';
                alert('개선 피드백이 전송되었습니다. 더 나은 서비스를 위해 노력하겠습니다.');
            }
        }

        // 카드 호버 효과
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.content-card').forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });
    </script>
</body>
</html>