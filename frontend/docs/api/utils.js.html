<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Utility functions library for Freshdesk Custom App
 * @description ğŸ› ï¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ëª¨ìŒ - ë²”ìš© í—¬í¼ í•¨ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬
 * 
 * This module provides general-purpose utility functions used throughout the app.
 * Designed with reusability and stability in mind, all functions guarantee error safety.
 * 
 * ì´ ëª¨ë“ˆì€ ì•± ì „ë°˜ì—ì„œ ì‚¬ìš©ë˜ëŠ” ë²”ìš©ì ì¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤.
 * ì¬ì‚¬ìš©ì„±ê³¼ ì•ˆì •ì„±ì„ ê³ ë ¤í•˜ì—¬ ì„¤ê³„ë˜ì—ˆìœ¼ë©°, ëª¨ë“  í•¨ìˆ˜ëŠ” ì—ëŸ¬ ì•ˆì „ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.
 * 
 * Main feature categories:
 * ì£¼ìš” ê¸°ëŠ¥ ì¹´í…Œê³ ë¦¬:
 * - JSON data processing (safe parsing, validation) / JSON ë°ì´í„° ì²˜ë¦¬ (ì•ˆì „í•œ íŒŒì‹±, ê²€ì¦)
 * - Local storage management (safe read/write) / ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬ (ì•ˆì „í•œ ì½ê¸°/ì“°ê¸°)
 * - Text processing (cleaning, formatting, validation) / í…ìŠ¤íŠ¸ ì²˜ë¦¬ (í´ë¦¬ë‹, í¬ë§·íŒ…, ê²€ì¦)
 * - Data validation (cache state, format validation) / ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ (ìºì‹œ ìƒíƒœ, í˜•ì‹ ê²€ì¦)
 * - Performance optimization (cached access, memoization) / ì„±ëŠ¥ ìµœì í™” (ìºì‹œëœ ì ‘ê·¼, ë©”ëª¨ì´ì œì´ì…˜)
 * 
 * @author We Do Soft Inc.
 * @since 2025.06.16
 * @version 2.0.0 (ëª¨ë“ˆí™” ë° ë¬¸ì„œí™” ê°•í™”)
 * @namespace Utils
 */

// Utils ëª¨ë“ˆ ì •ì˜ - ëª¨ë“  ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë¥¼ í•˜ë‚˜ì˜ ê°ì²´ë¡œ ê´€ë¦¬
window.Utils = {
  /**
   * ğŸ”’ ì•ˆì „í•œ JSON íŒŒì‹± í•¨ìˆ˜
   * 
   * ì˜ëª»ëœ JSON ë¬¸ìì—´ë¡œ ì¸í•œ ì•± í¬ë˜ì‹œë¥¼ ë°©ì§€í•˜ëŠ” ì•ˆì „í•œ JSON íŒŒì‹± í•¨ìˆ˜ì…ë‹ˆë‹¤.
   * API ì‘ë‹µì´ë‚˜ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„°ë¥¼ íŒŒì‹±í•  ë•Œ ì‚¬ìš©í•˜ì—¬ ì•ˆì •ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.
   * 
   * @param {string} jsonString - íŒŒì‹±í•  JSON ë¬¸ìì—´
   * @param {any} defaultValue - íŒŒì‹± ì‹¤íŒ¨ ì‹œ ë°˜í™˜í•  ê¸°ë³¸ê°’ (ê¸°ë³¸: null)
   * @returns {any} íŒŒì‹±ëœ ê°ì²´ ë˜ëŠ” ê¸°ë³¸ê°’
   * 
   * @example
   * // ì„±ê³µ ì¼€ì´ìŠ¤
   * const data = Utils.safeJsonParse('{"name": "test"}'); // {name: "test"}
   * 
   * // ì‹¤íŒ¨ ì¼€ì´ìŠ¤ (ì•ˆì „í•˜ê²Œ ê¸°ë³¸ê°’ ë°˜í™˜)
   * const data = Utils.safeJsonParse('invalid json', {}); // {}
   */
  safeJsonParse(jsonString, defaultValue = null) {
    try {
      if (!jsonString || typeof jsonString !== "string") {
        console.warn("[UTILS] ìœ íš¨í•˜ì§€ ì•Šì€ JSON ë¬¸ìì—´:", jsonString);
        return defaultValue;
      }

      return JSON.parse(jsonString);
    } catch (error) {
      console.error("[UTILS] JSON íŒŒì‹± ì˜¤ë¥˜:", error, "ì›ë³¸:", jsonString);
      GlobalState.ErrorHandler.handleError(error, {
        context: "utils_json_parse",
        userMessage: "JSON ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      });
      return defaultValue;
    }
  },

  /**
   * ğŸ’¾ ì•ˆì „í•œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì½ê¸° í•¨ìˆ˜
   * 
   * ë¸Œë¼ìš°ì € í˜¸í™˜ì„± ë¬¸ì œë‚˜ ìŠ¤í† ë¦¬ì§€ ì œí•œìœ¼ë¡œ ì¸í•œ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•˜ëŠ” ì•ˆì „í•œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì½ê¸° í•¨ìˆ˜ì…ë‹ˆë‹¤.
   * í”„ë¼ì´ë¹— ë¸Œë¼ìš°ì§• ëª¨ë“œë‚˜ ìŠ¤í† ë¦¬ì§€ ìš©ëŸ‰ ë¶€ì¡± ë“±ì˜ ìƒí™©ì—ì„œë„ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.
   * 
   * @param {string} key - ì½ì–´ì˜¬ í‚¤ ì´ë¦„
   * @param {any} defaultValue - ì½ê¸° ì‹¤íŒ¨ ì‹œ ë°˜í™˜í•  ê¸°ë³¸ê°’ (ê¸°ë³¸: null)
   * @returns {any} ì €ì¥ëœ ê°’ ë˜ëŠ” ê¸°ë³¸ê°’
   * 
   * @example
   * // ìºì‹œëœ ë°ì´í„° ì½ê¸°
   * const cachedData = Utils.safeLocalStorageGet('ticket_cache', {});
   */
  safeLocalStorageGet(key, defaultValue = null) {
    try {
      if (typeof Storage === "undefined") {
        console.warn("[UTILS] ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ê°€ ì§€ì›ë˜ì§€ ì•ŠìŒ");
        return defaultValue;
      }

      const value = localStorage.getItem(key);
      return value !== null ? this.safeJsonParse(value, defaultValue) : defaultValue;
    } catch (error) {
      console.error("[UTILS] ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì½ê¸° ì˜¤ë¥˜:", error);
      return defaultValue;
    }
  },

  safeLocalStorageSet(key, value) {
    try {
      if (typeof Storage === "undefined") {
        console.warn("[UTILS] ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ê°€ ì§€ì›ë˜ì§€ ì•ŠìŒ");
        return false;
      }

      const jsonValue = JSON.stringify(value);
      localStorage.setItem(key, jsonValue);
      return true;
    } catch (error) {
      console.error("[UTILS] ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì˜¤ë¥˜:", error);
      GlobalState.ErrorHandler.handleError(error, {
        context: "utils_localstorage_set",
        userMessage: "ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      });
      return false;
    }
  },

  // ì•ˆì „í•œ í•¨ìˆ˜ ì‹¤í–‰
  safeExecute(fn, context = "unknown", ...args) {
    try {
      if (typeof fn !== "function") {
        throw new Error(`${context}: ìœ íš¨í•˜ì§€ ì•Šì€ í•¨ìˆ˜ì…ë‹ˆë‹¤.`);
      }

      return fn(...args);
    } catch (error) {
      console.error(`[UTILS] í•¨ìˆ˜ ì‹¤í–‰ ì˜¤ë¥˜ (${context}):`, error);
      GlobalState.ErrorHandler.handleError(error, {
        context: `utils_safe_execute_${context}`,
        userMessage: "í•¨ìˆ˜ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      });
      return null;
    }
  },

  // ë¹„ë™ê¸° í•¨ìˆ˜ ì•ˆì „ ì‹¤í–‰
  async safeExecuteAsync(fn, context = "unknown", ...args) {
    try {
      if (typeof fn !== "function") {
        throw new Error(`${context}: ìœ íš¨í•˜ì§€ ì•Šì€ ë¹„ë™ê¸° í•¨ìˆ˜ì…ë‹ˆë‹¤.`);
      }

      return await fn(...args);
    } catch (error) {
      console.error(`[UTILS] ë¹„ë™ê¸° í•¨ìˆ˜ ì‹¤í–‰ ì˜¤ë¥˜ (${context}):`, error);
      GlobalState.ErrorHandler.handleError(error, {
        context: `utils_safe_execute_async_${context}`,
        userMessage: "ë¹„ë™ê¸° ì‘ì—… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
      });
      return null;
    }
  },

  // íƒ€ì… ê²€ì¦
  validateType(value, expectedType, fieldName = "value") {
    try {
      const actualType = typeof value;

      if (actualType !== expectedType) {
        throw new Error(
          `${fieldName}: ì˜ˆìƒ íƒ€ì… '${expectedType}', ì‹¤ì œ íƒ€ì… '${actualType}'`
        );
      }

      return true;
    } catch (error) {
      console.error("[UTILS] íƒ€ì… ê²€ì¦ ì˜¤ë¥˜:", error);
      return false;
    }
  },

  // í‹°ì¼“ ìƒíƒœì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ë°˜í™˜ í•¨ìˆ˜
  getStatusClass(status) {
    switch (status) {
      case 2:
        return "status-open"; // ì—´ë¦¼
      case 3:
        return "status-pending"; // ëŒ€ê¸°ì¤‘
      case 4:
        return "status-resolved"; // í•´ê²°ë¨
      case 5:
        return "status-closed"; // ë‹«í˜
      default:
        return "status-default"; // ê¸°ë³¸ê°’
    }
  },

  // í…ìŠ¤íŠ¸ ê¸¸ì´ ì œí•œ í•¨ìˆ˜
  truncateText(text, maxLength = 100) {
    if (!text) return "";
    if (text.length &lt;= maxLength) return text;
    return text.substring(0, maxLength) + "...";
  },

  // ìƒíƒœ ë²ˆí˜¸ë¥¼ í•œê¸€ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
  getStatusText(status) {
    switch (status) {
      case 2:
        return "ì—´ë¦¼";
      case 3:
        return "ëŒ€ê¸°ì¤‘";
      case 4:
        return "í•´ê²°ë¨";
      case 5:
        return "ë‹«í˜";
      default:
        return "ì•Œ ìˆ˜ ì—†ìŒ";
    }
  },

  // ìš°ì„ ìˆœìœ„ ë²ˆí˜¸ë¥¼ í•œê¸€ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
  getPriorityText(priority) {
    switch (priority) {
      case 1:
        return "ë‚®ìŒ";
      case 2:
        return "ë³´í†µ";
      case 3:
        return "ë†’ìŒ";
      case 4:
        return "ê¸´ê¸‰";
      default:
        return "ë³´í†µ";
    }
  },

  // ìš°ì„ ìˆœìœ„ì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ë°˜í™˜ í•¨ìˆ˜
  getPriorityClass(priority) {
    switch (priority) {
      case 1:
        return "priority-low";
      case 2:
        return "priority-medium";
      case 3:
        return "priority-high";
      case 4:
        return "priority-urgent";
      default:
        return "priority-medium";
    }
  },

  // ë‚ ì§œ í¬ë§·íŒ… í•¨ìˆ˜
  formatDate(dateString) {
    if (!dateString) return "";

    try {
      const date = new Date(dateString);
      if (isNaN(date.getTime())) return "ì˜ëª»ëœ ë‚ ì§œ";

      // í•œêµ­ ì‹œê°„ëŒ€ë¡œ ë³€í™˜í•˜ì—¬ í‘œì‹œ
      const options = {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        timeZone: "Asia/Seoul",
      };

      return date.toLocaleDateString("ko-KR", options);
    } catch (error) {
      console.warn("ë‚ ì§œ í¬ë§·íŒ… ì˜¤ë¥˜:", error);
      return "ë‚ ì§œ í˜•ì‹ ì˜¤ë¥˜";
    }
  },

  // ì„¤ëª… í…ìŠ¤íŠ¸ í¬ë§·íŒ… í•¨ìˆ˜
  formatDescription(description) {
    if (!description) return "";

    // HTML íƒœê·¸ ì œê±° ë° ê¸°ë³¸ í¬ë§·íŒ…
    return (
      description
        .replace(/&lt;[^>]*>/g, "") // HTML íƒœê·¸ ì œê±°
        .replace(/\n\n+/g, "\n\n") // ì—°ì†ëœ ì¤„ë°”ê¿ˆ ì •ë¦¬
        .replace(/\n/g, "&lt;br>") // ì¤„ë°”ê¿ˆì„ &lt;br>ë¡œ ë³€í™˜
        .substring(0, 500) + (description.length > 500 ? "..." : "")
    ); // ê¸¸ì´ ì œí•œ
  },

  // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜ (ìºì‹œê°€ ì˜¤ë˜ë˜ì—ˆëŠ”ì§€ í™•ì¸)
  isDataStale() {
    const globalData = this.getCachedGlobalData();
    if (!globalData.lastLoadTime) return true;
    const now = Date.now();
    const fiveMinutes = 5 * 60 * 1000; // 5ë¶„
    return now - globalData.lastLoadTime > fiveMinutes;
  },

  // ë¡œë”© ì™„ë£Œê¹Œì§€ ëŒ€ê¸°í•˜ëŠ” í•¨ìˆ˜
  async waitForLoadingComplete() {
    const maxWait = 10000; // ìµœëŒ€ 10ì´ˆ ëŒ€ê¸°
    const checkInterval = 100; // 100msë§ˆë‹¤ í™•ì¸
    let waited = 0;

    while (GlobalState.isLoading() &amp;&amp; waited &lt; maxWait) {
      await new Promise((resolve) => setTimeout(resolve, checkInterval));
      waited += checkInterval;
    }

    if (waited >= maxWait) {
      console.warn("âš ï¸ ë¡œë”© ì™„ë£Œ ëŒ€ê¸° ì‹œê°„ ì´ˆê³¼");
    }
  },

  // ê°„ë‹¨í•œ ë¡œë”© ì¸ë””ì¼€ì´í„° í‘œì‹œ
  showQuickLoadingIndicator() {
    console.log("â³ ë¡œë”© ì¸ë””ì¼€ì´í„° í‘œì‹œ");

    // ê¸°ì¡´ ë¡œë”© ì¸ë””ì¼€ì´í„°ê°€ ìˆìœ¼ë©´ ì œê±°
    this.hideQuickLoadingIndicator();

    // ë¡œë”© ì˜¤ë²„ë ˆì´ ìƒì„±
    const loadingOverlay = document.createElement("div");
    loadingOverlay.id = "quick-loading-overlay";
    loadingOverlay.innerHTML = `
      &lt;div class="loading-backdrop">
        &lt;div class="loading-spinner">
          &lt;div class="spinner">&lt;/div>
          &lt;div class="loading-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...&lt;/div>
        &lt;/div>
      &lt;/div>
    `;

    document.body.appendChild(loadingOverlay);
  },

  // ë¡œë”© ì¸ë””ì¼€ì´í„° ìˆ¨ê¹€
  hideQuickLoadingIndicator() {
    console.log("âœ… ë¡œë”© ì¸ë””ì¼€ì´í„° ìˆ¨ê¹€");
    const loadingOverlay = document.getElementById("quick-loading-overlay");
    if (loadingOverlay) {
      loadingOverlay.remove();
    }
  },

  /**
   * GlobalState ì ‘ê·¼ ìµœì í™”ë¥¼ ìœ„í•œ ìºì‹œëœ ë°ì´í„° getter
   * ë™ì¼í•œ í•¨ìˆ˜ í˜¸ì¶œ ë‚´ì—ì„œ ì¤‘ë³µ ì ‘ê·¼ì„ ë°©ì§€í•©ë‹ˆë‹¤.
   */
  getCachedGlobalData() {
    if (!this._cachedGlobalData || this._cacheTimestamp !== Date.now()) {
      this._cachedGlobalData = GlobalState.getGlobalTicketData();
      this._cacheTimestamp = Date.now();
    }
    return this._cachedGlobalData;
  },

  /**
   * ìºì‹œëœ ë°ì´í„° ë¬´íš¨í™”
   * ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ëœ í›„ í˜¸ì¶œí•˜ì—¬ ë‹¤ìŒ ì ‘ê·¼ ì‹œ ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ í•©ë‹ˆë‹¤.
   */
  invalidateGlobalDataCache() {
    this._cachedGlobalData = null;
    this._cacheTimestamp = null;
  },

  // ì˜ì¡´ì„± í™•ì¸ í•¨ìˆ˜ - ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ Utils ëª¨ë“ˆ ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ ì²´í¬
  isAvailable: function () {
    return typeof GlobalState !== "undefined";
  },
};

console.log("ğŸ“¦ Utils ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ - 11ê°œ í•¨ìˆ˜ exportë¨");

// ëª¨ë“ˆ ì˜ì¡´ì„± ì‹œìŠ¤í…œì— ë“±ë¡
if (typeof ModuleDependencyManager !== 'undefined') {
  ModuleDependencyManager.registerModule('utils', Object.keys(Utils).length);
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="global.html#API">API</a></li><li><a href="Data.html">Data</a></li><li><a href="DebugTools.html">DebugTools</a></li><li><a href="Events.html">Events</a></li><li><a href="GlobalState.html">GlobalState</a></li><li><a href="ModuleDependencyManager.html">ModuleDependencyManager</a></li><li><a href="UI.html">UI</a></li><li><a href="Utils.html">Utils</a></li></ul><h3>Global</h3><ul><li><a href="global.html#callBackendAPI">callBackendAPI</a></li><li><a href="global.html#client">client</a></li><li><a href="global.html#debugGlobalState">debugGlobalState</a></li><li><a href="global.html#extractCompanyIdFromDomain">extractCompanyIdFromDomain</a></li><li><a href="global.html#getFreshdeskConfigFromIparams">getFreshdeskConfigFromIparams</a></li><li><a href="global.html#getGlobalLoading">getGlobalLoading</a></li><li><a href="global.html#getGlobalTicketData">getGlobalTicketData</a></li><li><a href="global.html#getInitialized">getInitialized</a></li><li><a href="global.html#globalTicketData">globalTicketData</a></li><li><a href="global.html#initializeApp">initializeApp</a></li><li><a href="global.html#isGlobalDataValid">isGlobalDataValid</a></li><li><a href="global.html#isInitialized">isInitialized</a></li><li><a href="global.html#loadInitialDataFromBackend">loadInitialDataFromBackend</a></li><li><a href="global.html#loadSimilarTicketsFromBackend">loadSimilarTicketsFromBackend</a></li><li><a href="global.html#resetGlobalTicketCache">resetGlobalTicketCache</a></li><li><a href="global.html#setGlobalLoading">setGlobalLoading</a></li><li><a href="global.html#setInitialized">setInitialized</a></li><li><a href="global.html#showErrorInResults">showErrorInResults</a></li><li><a href="global.html#showLoadingInResults">showLoadingInResults</a></li><li><a href="global.html#smartDomainParsingFrontend">smartDomainParsingFrontend</a></li><li><a href="global.html#updateGlobalTicketData">updateGlobalTicketData</a></li><li><a href="global.html#validateAndInitializeApp">validateAndInitializeApp</a></li><li><a href="global.html#validateGlobalState">validateGlobalState</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Jun 16 2025 23:16:45 GMT+0900 (ëŒ€í•œë¯¼êµ­ í‘œì¤€ì‹œ)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
