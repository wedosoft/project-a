#!/bin/bash

# Test script for verifying the simplified iparams and API configuration
echo "üß™ Testing simplified iparams and API configuration..."

# Test 1: Check if iparams.json exists with correct structure
echo "1. Testing iparams.json structure..."
if [ -f "/home/runner/work/project-a/project-a/frontend/config/iparams.json" ]; then
    echo "‚úÖ iparams.json exists"
    # Validate JSON structure
    if jq empty /home/runner/work/project-a/project-a/frontend/config/iparams.json 2>/dev/null; then
        echo "‚úÖ iparams.json is valid JSON"
        
        # Check if only expected fields exist
        fields=$(jq -r 'keys[]' /home/runner/work/project-a/project-a/frontend/config/iparams.json)
        expected_fields=("freshdesk_domain" "freshdesk_api_key")
        
        for field in $fields; do
            if [[ " ${expected_fields[@]} " =~ " ${field} " ]]; then
                echo "‚úÖ Field $field is expected"
            else
                echo "‚ùå Unexpected field: $field"
            fi
        done
    else
        echo "‚ùå iparams.json is not valid JSON"
    fi
else
    echo "‚ùå iparams.json does not exist"
fi

echo ""

# Test 2: Check if iparams.html has been simplified
echo "2. Testing iparams.html simplification..."
if [ -f "/home/runner/work/project-a/project-a/frontend/config/iparams.html" ]; then
    echo "‚úÖ iparams.html exists"
    
    # Check if backend_url field has been removed
    if grep -q "backend_url" /home/runner/work/project-a/project-a/frontend/config/iparams.html; then
        echo "‚ùå backend_url field still exists in iparams.html"
    else
        echo "‚úÖ backend_url field has been removed"
    fi
    
    # Check if company_id field has been removed
    if grep -q "company_id" /home/runner/work/project-a/project-a/frontend/config/iparams.html; then
        echo "‚ùå company_id field still exists in iparams.html"
    else
        echo "‚úÖ company_id field has been removed"
    fi
    
    # Check if freshdesk_domain field exists
    if grep -q "freshdesk_domain" /home/runner/work/project-a/project-a/frontend/config/iparams.html; then
        echo "‚úÖ freshdesk_domain field exists"
    else
        echo "‚ùå freshdesk_domain field is missing"
    fi
    
    # Check if freshdesk_api_key field exists
    if grep -q "freshdesk_api_key" /home/runner/work/project-a/project-a/frontend/config/iparams.html; then
        echo "‚úÖ freshdesk_api_key field exists"
    else
        echo "‚ùå freshdesk_api_key field is missing"
    fi
else
    echo "‚ùå iparams.html does not exist"
fi

echo ""

# Test 3: Check API module baseURL configuration
echo "3. Testing API module baseURL configuration..."
if [ -f "/home/runner/work/project-a/project-a/frontend/app/scripts/api.js" ]; then
    echo "‚úÖ api.js exists"
    
    # Check if baseURL uses hardcoded URLs instead of iparams
    if grep -q "iparams.*backend_url" /home/runner/work/project-a/project-a/frontend/app/scripts/api.js; then
        echo "‚ùå API still references iparams backend_url"
    else
        echo "‚úÖ API no longer references iparams backend_url"
    fi
    
    # Check if production backend URL placeholder exists
    if grep -q "your-production-backend.amazonaws.com" /home/runner/work/project-a/project-a/frontend/app/scripts/api.js; then
        echo "‚úÖ Production backend URL placeholder exists"
    else
        echo "‚ùå Production backend URL placeholder missing"
    fi
else
    echo "‚ùå api.js does not exist"
fi

echo ""
echo "üéØ Test Summary:"
echo "- iparams.json should only contain freshdesk_domain and freshdesk_api_key"
echo "- iparams.html should not have backend_url or company_id fields"
echo "- API module should use hardcoded backend URLs instead of iparams"
echo ""
echo "‚úÖ Testing completed!"